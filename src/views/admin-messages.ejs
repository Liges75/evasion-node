<%- include('partials/header') %>

<main class="container" style="margin-top: 120px; margin-bottom: 40px;">
  <h1 class="text-center mb-4">Messages reçus</h1>

  <% if (messages.length === 0) { %>
    <p class="text-center text-muted">Aucun message pour le moment.</p>
  <% } else { %>
    <table class="table table-striped table-hover">
      <thead class="table-warning">
        <tr>
          <th>#</th>
          <th>Nom</th>
          <th>Email</th>
          <th>User ID</th>
          <th>Sujet</th>
          <th>Message</th>
          <th>Date</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody>
        <% messages.forEach(msg => { %>
          <tr>
            <td><%= msg.id_message %></td>
            <td><%= msg.nom %> <%= msg.prenom %></td>
            <td><%= msg.email %></td>
            <td style="text-align: center;"><%= msg.id_user %></td>
            <td><%= msg.sujet %></td>
            <td><%= msg.message %></td>
            <td><%= msg.date_message %></td>
            <td>
              <form action="/admin/messages/<%= msg.id_message %>/statut" method="post" class="d-inline">
                <% 
                  let statusClass = 'status-default';
                  if (msg.statut === 'Non lu')      statusClass = 'status-nonlu';
                  else if (msg.statut === 'Lu')     statusClass = 'status-lu';
                  else if (msg.statut === 'Répondu')statusClass = 'status-repondu';
                  else if (msg.statut === 'Classé') statusClass = 'status-classe';
                %>
                <select name="statut"
                        class="form-select form-select-sm <%= statusClass %>"
                        onchange="this.form.submit()">
                  <option value="Non lu"   <%= msg.statut === 'Non lu' ? 'selected' : '' %>>Non lu</option>
                  <option value="Lu"       <%= msg.statut === 'Lu' ? 'selected' : '' %>>Lu</option>
                  <option value="Répondu"  <%= msg.statut === 'Répondu' ? 'selected' : '' %>>Répondu</option>
                  <option value="Classé"   <%= msg.statut === 'Classé' ? 'selected' : '' %>>Classé</option>
                </select>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
</main>

<%- include('partials/footer') %>
